---
import BaseLayout from '../../layouts/BaseLayout.astro'
import InscriptionsStage from '../../components/svelte/site/inscriptionsStage.svelte'
//const adhesionsTarifsTemp = await fetch(import.meta.env.PUBLIC_CMS + "acl-adhesions?token=" + import.meta.env.PUBLIC_TOKEN_SITE)
//const adhesionsTarifs = await adhesionsTarifsTemp.json()
var data = await fetch(import.meta.env.BASEROW_URL + "rows/table/655/?user_field_names=true", {headers: {Authorization: "Token " + import.meta.env.TOKEN_BASEROW_LECTURE}})
const adhesionsTarifsTemp = await data.json()
const adhesionsTarifs = adhesionsTarifsTemp.results.map((item) => {return {id: item.id, type: item.type, valeur: item.valeur, isSappey: item.isSappey, isFamiliale: item.isFamiliale}})

//const dernierStageTemp = await fetch(import.meta.env.PUBLIC_CMS + "acl-stage-inscriptions?_sort=id:DESC&token=" + import.meta.env.PUBLIC_TOKEN_SITE)
//const dernierStage = await dernierStageTemp.json()

data = await fetch(import.meta.env.BASEROW_URL + "rows/table/666/?user_field_names=true&filter__field_5949__not_empty&order_by=-année", {headers: {Authorization: "Token " + import.meta.env.TOKEN_BASEROW_LECTURE}})
const detailsStage = (await data.json()).results
const tarifStage = detailsStage[0].tarif
const acompte = detailsStage[0].acompte
---
<BaseLayout title="Inscription Stage été">
  <InscriptionsStage client:load {adhesionsTarifs} {tarifStage} {acompte}/>
</BaseLayout>